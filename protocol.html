

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PSC TCP Protocol &mdash; pscdrv 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="pscdrv 1.0 documentation" href="index.html" />
    <link rel="next" title="Message Processing" href="processing.html" />
    <link rel="prev" title="The PSC Driver" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="processing.html" title="Message Processing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="The PSC Driver"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">pscdrv 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="psc-tcp-protocol">
<h1>PSC TCP Protocol<a class="headerlink" href="#psc-tcp-protocol" title="Permalink to this headline">¶</a></h1>
<p>The PSC transport protocol uses TCP to transport a bi-direction stream of messages
between a device and an IOC.
Each message consists of a fixed length 8 byte header followed by a variable length body.</p>
<img alt="_images/message-stream.png" src="_images/message-stream.png" />
<p>The header has 3 fields: framing marker (2 bytes), message ID (2 bytes), and body length (4 bytes).
The framing marker is ASCII charactors &#8216;P&#8217; and &#8216;S&#8217;.
The other two are unsigned integers in big endian byte order.</p>
<div class="highlight-python"><pre>      0     1     2     3
   +-----+-----+-----------+
0  |  P  |  S  |   Msg ID  |
   +-----+-----+-----------+
4  |      Body Length      |
   +-----------------------+
8  |      Body bytes ...   |</pre>
</div>
<p>An equivalent C structure definition for a message header would be:</p>
<div class="highlight-python"><pre>struct pscHeader {
  char P; /* must be 'P' */
  char S; /* must be 'S' */
  uint16_t msgid;
  uint32_t bodylen; /* in bytes */
};
assert(sizeof(struct pscdrvHeader)==8);</pre>
</div>
<div class="section" id="single-register-sub-protocol">
<h2>Single Register Sub-protocol<a class="headerlink" href="#single-register-sub-protocol" title="Permalink to this headline">¶</a></h2>
<p>The Single Register Write Device Supports understand a sub-header containing a 32-bit unsigned
integer address and 0 or more bytes of value.  Thus the minimum body length allowed is 4 bytes.</p>
<p>This is included to support the common case of writing individually
addressable registers without exhausting the available message IDs.</p>
<div class="highlight-python"><pre>      0     1     2     3
   +-----+-----+-----------+
0  |  P  |  S  |   Msg ID  |
   +-----+-----+-----+-----+
4  |      Body Length      |
   +-----+-----+-----+-----+
8  |         Address       |
   +-----+-----+-----------+
C  |         Value         |
   +-----------------------+
F  |         Value ...     |</pre>
</div>
</div>
<div class="section" id="protocol-usage-and-device-design">
<h2>Protocol Usage and Device Design<a class="headerlink" href="#protocol-usage-and-device-design" title="Permalink to this headline">¶</a></h2>
<p>In the PSC driver, the message ID is used to determine how the message body is interpreted.
For example message ID 1 might be used by a device to send/recv a fixed length array of register values,
while ID 20 is used to send a variable length array of ADC values.</p>
<p>It is not necessary for a given message ID to have the same meaning when received by the Device,
as when received by the IOC.  However, this is recommended to preserve engineer sanity.</p>
<p>By design this protocol does not require that messages are acknowledged, or replied to, but the recipient.
The TCP transport protocol already provides some guarantees of message delivery.
It is intended that send/receive synchronization can be achieved by, for example,
ensuring that when a device register is changed, that a message with the updated value will be sent to the IOC (or IOCs)
automatically.</p>
<p>Explicit request/response can to some extent be implemented with Records.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">PSC TCP Protocol</a><ul>
<li><a class="reference internal" href="#single-register-sub-protocol">Single Register Sub-protocol</a></li>
<li><a class="reference internal" href="#protocol-usage-and-device-design">Protocol Usage and Device Design</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">The PSC Driver</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="processing.html"
                        title="next chapter">Message Processing</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/protocol.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="processing.html" title="Message Processing"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="The PSC Driver"
             >previous</a> |</li>
        <li><a href="index.html">pscdrv 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Michael Davidsaver.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>